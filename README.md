# StampFly制御システム完全ガイド

M5StampFlyを使ったマルチコプタ制御システムの包括的な教育・技術解説プロジェクトです。

## 📖 概要

本プロジェクトは、M5StampFlyプラットフォームを用いたマルチコプタ制御システムの実装方法を詳細に解説し、ドローン制御技術の学習・教育に貢献することを目的としています。

### 主な特徴

- **ESP-IDF対応**: 産業レベルの組み込み開発環境
- **ESP-NOW通信**: 低遅延・高信頼性通信システム
- **包括的安全機能**: リアルタイム安全監視・フェイルセーフ
- **高度バッテリー管理**: 300mAh 1S HV LiPo専用システム
- **段階的学習**: 基礎理論から実装まで体系的解説

## 📚 内容構成

| 章 | タイトル | 内容 |
|---|---------|------|
| 第1章 | ドローンとは何か | 基礎概念・M5StampFly紹介 |
| 第2章 | 空気力学と飛行原理 | 飛行物理・数学モデル |
| 第3章 | 剛体力学とクォータニオン | 姿勢表現・運動方程式 |
| 第4章 | 制御理論入門 | PID制御・状態フィードバック |
| 第5章 | マルチコプタ制御入門 | 実装・安全機能・通信 |
| 第6章 | 飛行試験 | テスト手法・検証方法 |
| 第7章 | まとめと発展 | 応用・今後の展開 |

## 🛠️ 技術仕様

### ハードウェア
- **メインボード**: M5StampS3 (ESP32-S3)
- **IMU**: BMI270 (6軸)
- **磁力計**: BMM150
- **気圧センサ**: BMP280
- **距離センサ**: VL53L3CX × 2
- **オプティカルフロー**: PMW3901MB
- **モータ**: 716-17600kv × 4
- **バッテリー**: 300mAh 1S HV LiPo

### ソフトウェア
- **開発環境**: ESP-IDF
- **RTOS**: FreeRTOS
- **通信**: ESP-NOW
- **言語**: C/C++

## 🚀 主要機能

### 安全システム
- リアルタイム安全監視 (100Hz)
- ハードウェア故障検出
- 通信途絶対応
- 緊急着陸システム

### バッテリー管理
- HV LiPo専用アルゴリズム
- 複合残量推定
- 健全性診断
- 飛行時間予測

### 通信システム
- CRC付き信頼性通信
- 優先度制御・ACK・再送
- AES暗号化・認証
- 通信品質監視

## 📋 使用要件

### 教育目的限定
本プロジェクトは教育・学習目的に限定されています。

### 安全な環境での使用
- 屋内での初期テスト推奨
- 小型軽量設計で屋内使用に最適
- 適切な安全距離の確保
- 法規制の遵守

## 🔧 セットアップ

### 1. 環境準備
```bash
# ESP-IDFのインストール
# https://docs.espressif.com/projects/esp-idf/

# プロジェクトクローン
git clone https://github.com/kouhei1970/stampfly-control-guide.git
cd stampfly-control-guide
```

### 2. ハードウェア要件
- M5StampFly本体
- M5StampS3 with ESP32-S3
- 300mAh 1S HV LiPoバッテリー

### 3. ビルドと書き込み
```bash
# 設定
idf.py menuconfig

# ビルド
idf.py build

# 書き込み
idf.py flash monitor
```

### 4. 安全確認事項
- 初回テストは必ず屋内で実施
- **プロペラ脱落注意**: 回転中のプロペラを上から覗かない（個体差により脱落の可能性）
- プロペラの差し込み確認（緩い場合は交換を検討）
- バッテリー電圧の確認（3.4V以上）
- 周囲の安全確認

## 📖 学習の進め方

1. **理論学習**: 第1-4章で基礎理論を習得
2. **実装学習**: 第5章で実際のコード実装を学習
3. **実践**: 第6章でテスト・検証方法を実践
4. **応用**: 第7章で発展的内容に挑戦

## 🤝 貢献

プロジェクトへの貢献を歓迎します：

- バグ報告: [Issues](https://github.com/kouhei1970/stampfly-control-guide/issues)
- 機能改善: Pull Request
- ドキュメント改善: Pull Request

## 📄 ライセンス

- **ドキュメント**: CC BY 4.0
- **ソースコード**: MIT License

詳細は [PROJECT_REQUIREMENTS.md](PROJECT_REQUIREMENTS.md) を参照してください。

## ⚠️ 免責事項

本プロジェクトの使用により生じた直接的・間接的損害について、作成者は一切責任を負いません。安全な環境での使用を心がけ、各国・地域の法規制を遵守してください。

## 📞 連絡先

- **作成者**: Kouhei Ito
- **メール**: kouhei.ito@itolab-ktc.com
- **GitHub**: [@kouhei1970](https://github.com/kouhei1970)

---

*M5StampFlyで学ぶドローン制御の世界へようこそ！*